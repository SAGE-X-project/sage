# SAGE í”„ë¡œì íŠ¸ ìƒì„¸ ê°€ì´ë“œ - Part 1: í”„ë¡œì íŠ¸ ê°œìš” ë° ì•„í‚¤í…ì²˜

> **ëŒ€ìƒ ë…ì**: í”„ë¡œê·¸ë˜ë° ì´ˆê¸‰ìë¶€í„° ì¤‘ê¸‰ ê°œë°œìê¹Œì§€
> **ì‘ì„±ì¼**: 2025-10-07
> **ë²„ì „**: 1.0

---

## ëª©ì°¨

1. [SAGEë€ ë¬´ì—‡ì¸ê°€?](#1-sageë€-ë¬´ì—‡ì¸ê°€)
2. [ì™œ SAGEê°€ í•„ìš”í•œê°€?](#2-ì™œ-sageê°€-í•„ìš”í•œê°€)
3. [ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”](#3-ì „ì²´-ì•„í‚¤í…ì²˜-ê°œìš”)
4. [í•µì‹¬ ê°œë… ì„¤ëª…](#4-í•µì‹¬-ê°œë…-ì„¤ëª…)
5. [í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„¸ ë¶„ì„](#5-í”„ë¡œì íŠ¸-êµ¬ì¡°-ìƒì„¸-ë¶„ì„)

---

## 1. SAGEë€ ë¬´ì—‡ì¸ê°€?

### 1.1 í”„ë¡œì íŠ¸ ì •ì˜

**SAGE (Secure Agent Guarantee Engine)**ëŠ” AI ì—ì´ì „íŠ¸ë“¤ì´ ì„œë¡œ ì•ˆì „í•˜ê²Œ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ë³´ì•ˆ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

#### ì‰¬ìš´ ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°

ì¼ë°˜ì ì¸ ì´ë©”ì¼ ì‹œìŠ¤í…œì„ ìƒê°í•´ë´…ì‹œë‹¤:

- ì´ë©”ì¼ì„ ë³´ë‚¼ ë•Œ ëˆ„êµ¬ë‚˜ ë‚´ ì´ë¦„ìœ¼ë¡œ ì´ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ì´ë©”ì¼ ë‚´ìš©ì´ ì¤‘ê°„ì— ê°€ë¡œì±„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ë°›ì€ ì´ë©”ì¼ì´ ì •ë§ ê·¸ ì‚¬ëŒì´ ë³´ë‚¸ ê²ƒì¸ì§€ í™•ì‹ í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤

SAGEëŠ” AI ì—ì´ì „íŠ¸ë“¤ ì‚¬ì´ì˜ í†µì‹ ì—ì„œ ì´ëŸ° ë¬¸ì œë“¤ì„ í•´ê²°í•©ë‹ˆë‹¤:

- âœ… **ì‹ ì› ë³´ì¦**: ë¸”ë¡ì²´ì¸ì„ í†µí•´ ê° AI ì—ì´ì „íŠ¸ì˜ ì‹ ì›ì„ ë³´ì¦
- âœ… **ì•”í˜¸í™”ëœ í†µì‹ **: ë©”ì‹œì§€ê°€ ì¤‘ê°„ì— ê°€ë¡œì±„ì´ë”ë¼ë„ ì½ì„ ìˆ˜ ì—†ìŒ
- âœ… **ì„œëª… ê²€ì¦**: ë©”ì‹œì§€ê°€ ì •ë§ ê·¸ ì—ì´ì „íŠ¸ê°€ ë³´ë‚¸ ê²ƒì¸ì§€ ê²€ì¦ ê°€ëŠ¥

### 1.2 í•µì‹¬ ê¸°ëŠ¥

#### ê¸°ëŠ¥ 1: ì¢…ë‹¨ê°„ ì•”í˜¸í™” í•¸ë“œì…°ì´í¬ (End-to-End Encrypted Handshake)

**ë¬¸ì œ**: AI ì—ì´ì „íŠ¸ Aì™€ Bê°€ ì²˜ìŒ ë§Œë‚¬ì„ ë•Œ ì–´ë–»ê²Œ ì•ˆì „í•œ í†µì‹  ì±„ë„ì„ ë§Œë“¤ê¹Œ?

**"TLS í•¸ë“œì…°ì´í¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ì§€ ì•Šë‚˜ìš”?"**

ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤! í•˜ì§€ë§Œ SAGEëŠ” TLSì™€ëŠ” **ë‹¤ë¥¸ ëª©ì **ê³¼ **ë‹¤ë¥¸ ê³„ì¸µ**ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤:

```
TLS vs HPKE í•¸ë“œì…°ì´í¬ ë¹„êµ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                TLS í•¸ë“œì…°ì´í¬                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ëª©ì : ì „ì†¡ ê³„ì¸µ(Transport Layer) ë³´ì•ˆ ì—°ê²°                 â”‚
â”‚ ëŒ€ìƒ: í´ë¼ì´ì–¸íŠ¸ â†” ì„œë²„ (ë„¤íŠ¸ì›Œí¬ ì—°ê²°)                      â”‚
â”‚ íŠ¹ì§•:                                                   â”‚
â”‚  - ì–‘ë°©í–¥ ëŒ€í™”í˜• í”„ë¡œí† ì½œ (Interactive)                    â”‚
â”‚  - ì‹¤ì‹œê°„ í˜‘ìƒ í•„ìš” (Cipher Suite, ì¸ì¦ì„œ ë“±)              â”‚
â”‚  - ì—°ê²° ê¸°ë°˜ (Connection-oriented)                       â”‚
â”‚  - ì„¸ì…˜ì´ ëŠì–´ì§€ë©´ ë³´ì•ˆë„ ì¢…ë£Œ                              â”‚
â”‚                                                         â”‚
â”‚ í•œê³„:                                                   â”‚
â”‚  âŒ ì¤‘ê°„ ì„œë²„ì—ì„œ TLS ì¢…ë£Œ ì‹œ í‰ë¬¸ ë…¸ì¶œ                     â”‚
â”‚  âŒ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ë°ì´í„°ëŠ” ë³´í˜¸ ëª»í•¨                     â”‚
â”‚  âŒ ë©”ì‹œì§€ ìì²´ì˜ ì¢…ë‹¨ê°„ ì•”í˜¸í™” ë¶ˆê°€ëŠ¥                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              HPKE (RFC 9180) í•¸ë“œì…°ì´í¬                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ëª©ì : ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ë©”ì‹œì§€ ì•”í˜¸í™”                        â”‚
â”‚ ëŒ€ìƒ: ì—ì´ì „íŠ¸ A â†” ì—ì´ì „íŠ¸ B (ë…¼ë¦¬ì  ê°œì²´)                  â”‚
â”‚ íŠ¹ì§•:                                                    â”‚
â”‚  - ë‹¨ë°©í–¥ ì•”í˜¸í™” (One-way encryption)                     â”‚
â”‚  - ë¹„ëŒ€í™”í˜• (Non-interactive) - ìƒëŒ€ë°© ì‘ë‹µ ë¶ˆí•„ìš”          â”‚
â”‚  - ë©”ì‹œì§€ ê¸°ë°˜ (Message-oriented)                         â”‚
â”‚  - ì¤‘ê°„ ì„œë²„ì™€ ë¬´ê´€í•˜ê²Œ ì¢…ë‹¨ê°„ ë³´í˜¸                          â”‚
â”‚                                                         â”‚
â”‚ ì¥ì :                                                    â”‚
â”‚  âœ… TLS ìœ„ì—ì„œ ì¶”ê°€ ì•”í˜¸í™” ê³„ì¸µ ì œê³µ                        â”‚
â”‚  âœ… ì¤‘ê°„ ì„œë²„ê°€ ë©”ì‹œì§€ ë‚´ìš©ì„ ë³¼ ìˆ˜ ì—†ìŒ                     â”‚
â”‚  âœ… ë¹„ë™ê¸° í†µì‹ ì— ìµœì í™” (ì˜¤í”„ë¼ì¸ ë©”ì‹œì§€ ë“±)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì™œ HPKEë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?

1. ê³„ì¸µ ë¶„ë¦¬ (Layer Separation)
   TLS: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ë³´í˜¸ (TCP/IP ë ˆë²¨)
   HPKE: ë©”ì‹œì§€ ë‚´ìš©ì„ ë³´í˜¸ (Application ë ˆë²¨)

   Agent A â†’ [TLS ì•”í˜¸í™”] â†’ [ì¤‘ê°„ ì„œë²„] â†’ [TLS ì¬ì•”í˜¸í™”] â†’ Agent B
            â””â”€â”€ HPKEë¡œ ë©”ì‹œì§€ëŠ” ì´ë¯¸ ì•”í˜¸í™”ë¨ â”€â”€â”˜

   ì¤‘ê°„ ì„œë²„ëŠ” TLSëŠ” ë³¼ ìˆ˜ ìˆì§€ë§Œ, HPKEë¡œ ì•”í˜¸í™”ëœ ë©”ì‹œì§€ëŠ” ëª» ë´„!

2. ë¹„ë™ê¸° í†µì‹  ì§€ì›
   TLS: ì‹¤ì‹œê°„ ì—°ê²° í•„ìš” (ì–‘ìª½ ë‹¤ ì˜¨ë¼ì¸ì´ì–´ì•¼ í•¨)
   HPKE: ìˆ˜ì‹ ì ê³µê°œí‚¤ë§Œ ìˆìœ¼ë©´ ì•”í˜¸í™” ê°€ëŠ¥

   ì˜ˆ: ì´ë©”ì¼ì²˜ëŸ¼ ìƒëŒ€ë°©ì´ ì˜¤í”„ë¼ì¸ì´ì–´ë„ ë©”ì‹œì§€ ì•”í˜¸í™” ê°€ëŠ¥

3. ìœ ì—°ì„±
   TLS: ê³ ì •ëœ í”„ë¡œí† ì½œ ìŠ¤íƒ
   HPKE: ì•”í˜¸í™” primitive (ì›ì‹œ ë„êµ¬)
        â†’ ë‹¤ì–‘í•œ í”„ë¡œí† ì½œì— ì‚½ì… ê°€ëŠ¥
        â†’ ì‹¬ì§€ì–´ TLS ë‚´ë¶€ì—ì„œë„ ì‚¬ìš© (TLS ECH)

4. ì„±ëŠ¥ ìµœì í™”
   TLS: ë§¤ë²ˆ í•¸ë“œì…°ì´í¬ ì˜¤ë²„í—¤ë“œ
   HPKE: ê³µê°œí‚¤ë§Œ ìˆìœ¼ë©´ ì¦‰ì‹œ ì•”í˜¸í™”
        â†’ ë©”ì‹œì§€ë‹¹ í•œ ë²ˆì˜ ì•”í˜¸í™”ë§Œ í•„ìš”

ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent Aê°€ Agent Bì—ê²Œ ë©”ì‹œì§€ ì „ì†¡                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Aê°€ Bì˜ ê³µê°œí‚¤ë¥¼ ë¸”ë¡ì²´ì¸ì—ì„œ ì¡°íšŒ                        â”‚
â”‚ 2. HPKEë¡œ ë©”ì‹œì§€ ì•”í˜¸í™” (Bì˜ ê³µê°œí‚¤ ì‚¬ìš©)                    â”‚
â”‚ 3. ì•”í˜¸í™”ëœ ë©”ì‹œì§€ë¥¼ TLSë¡œ ì „ì†¡                             â”‚
â”‚ 4. ì¤‘ê°„ ì„œë²„ë“¤: TLSëŠ” ë³¼ ìˆ˜ ìˆì§€ë§Œ ë©”ì‹œì§€ ë‚´ìš©ì€ ëª» ë´„         â”‚
â”‚ 5. Bê°€ ìˆ˜ì‹ : ìì‹ ì˜ ê°œì¸í‚¤ë¡œë§Œ HPKE ë©”ì‹œì§€ ë³µí˜¸í™” ê°€ëŠ¥         â”‚
â”‚                                                         â”‚
â”‚ ê²°ê³¼: ì´ì¤‘ ì•”í˜¸í™” (Defense in Depth)                       â”‚
â”‚  - ì™¸ë¶€ì¸µ: TLS (ì „ì†¡ ë³´ì•ˆ)                                 â”‚
â”‚  - ë‚´ë¶€ì¸µ: HPKE (ë©”ì‹œì§€ ë³´ì•ˆ)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•´ê²°ì±…**: HPKE (RFC 9180) ê¸°ë°˜ í•¸ë“œì…°ì´í¬

HPKEëŠ” TLSë¥¼ **ëŒ€ì²´**í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, TLS **ìœ„ì—** ì¶”ê°€ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ ì•”í˜¸í™”ì…ë‹ˆë‹¤.

```
SAGE í•¸ë“œì…°ì´í¬ ë‹¨ê³„ (HPKE ì‚¬ìš©):

1. Init (A â†’ B)
   - Aê°€ DIDì—ì„œ Bì˜ HPKE ê³µê°œí‚¤(pkB) ì¡°íšŒ
   - HPKE Base: SetupS(pkB, info) â†’ enc(ìº¡ìŠí™”), exporter(ì„¸ì…˜ì‹œë“œ)
   - A2Aë¡œ {enc, info, exportCtx, nonce, ts} ì „ì†¡ (Ed25519 ì„œëª…)

2. Ack (B â†’ A)
   - ì„œëª…/ts/nonce ê²€ì¦, ì¬ìƒ ì°¨ë‹¨
   - HPKE Base: SetupR(skB, enc, info) â†’ exporter(ì„¸ì…˜ì‹œë“œ)
   - kid ë°œê¸‰, ackTag = HMAC(exporter, ctxIDâ€–nonceâ€–kid)
   - A2Aë¡œ {kid, ackTag} ì‘ë‹µ (Ed25519 ì„œëª…)

-> ê³µìœ  ë¹„ë°€ ìƒì„±!

3. Complete (A, ë¡œì»¬)
   - Aê°€ ackTag ê²€ì¦(ìƒìˆ˜ì‹œê°„ ë¹„êµ)
   - exporterë¡œ HKDF â†’ ë°©í–¥ë³„ í‚¤(c2s/s2c) ìœ ë„, AEAD(ChaCha20-Poly1305) ì´ˆê¸°í™”
   - kid â†” ì„¸ì…˜ ë°”ì¸ë”© â†’ ì‚¬ìš© ì‹œì‘

4. ì•ˆì „í•œ ì„¸ì…˜ ì‹œì‘
   - ì„¸ì…˜ í‚¤ë¡œ ChaCha20-Poly1305 ì•”í˜¸í™”
   - Forward Secrecy: ì„ì‹œ í‚¤ëŠ” ì¦‰ì‹œ ì‚­ì œ
```

**ì‚¬ìš©ëœ ê¸°ìˆ **:

- **X25519**: í‚¤ êµí™˜ ì•Œê³ ë¦¬ì¦˜ (ë§¤ìš° ë¹ ë¥´ê³  ì•ˆì „í•¨)
- **HPKE (RFC 9180)**: ìµœì‹  í‘œì¤€ í•˜ì´ë¸Œë¦¬ë“œ ì•”í˜¸í™” primitive
- **Forward Secrecy**: ê³¼ê±° ë©”ì‹œì§€ê°€ ë‚˜ì¤‘ì— ë…¸ì¶œë˜ì–´ë„ í•´ë… ë¶ˆê°€ëŠ¥
- **ì´ì¤‘ ì•”í˜¸í™”**: TLS (ì „ì†¡) + HPKE (ì• í”Œë¦¬ì¼€ì´ì…˜)

#### ê¸°ëŠ¥ 2: RFC 9421 ì¤€ìˆ˜ (HTTP ë©”ì‹œì§€ ì„œëª…)

**ë¬¸ì œ**: HTTP ìš”ì²­ì´ ì¤‘ê°„ì— ë³€ì¡°ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒì„ ì–´ë–»ê²Œ ë³´ì¥í•˜ë‚˜?

**ì™œ TLS/HTTPSë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•œê°€?**

ë§ì€ ì‚¬ëŒë“¤ì´ "HTTPSë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆì „í•œ ê±° ì•„ë‹Œê°€ìš”?"ë¼ê³  ê¶ê¸ˆí•´í•©ë‹ˆë‹¤. TLSëŠ” í›Œë¥­í•œ ë³´ì•ˆ í”„ë¡œí† ì½œì´ì§€ë§Œ, AI ì—ì´ì „íŠ¸ í†µì‹ ì—ëŠ” ì¹˜ëª…ì ì¸ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤:

```
TLSì˜ í•œê³„ì :

1. ì¢…ë‹¨ê°„(End-to-End) ë³´ì•ˆ ë¶ˆê°€ëŠ¥
   ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤:
   AI Agent A â”€â”€TLSâ”€â”€â†’ [ë¡œë“œë°¸ëŸ°ì„œ] â”€â”€TLSâ”€â”€â†’ AI Agent B
                        â†‘
                    TLS ì¢…ë£Œ ì§€ì 

   - TLSëŠ” ê° ì—°ê²° êµ¬ê°„ë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘
   - ë¡œë“œë°¸ëŸ°ì„œì—ì„œ TLSê°€ ì¢…ë£Œë˜ë©´ ë©”ì‹œì§€ê°€ í‰ë¬¸ìœ¼ë¡œ ë…¸ì¶œ
   - ì¤‘ê°„ ì„œë²„(í”„ë¡ì‹œ, CDN, API ê²Œì´íŠ¸ì›¨ì´)ê°€ ë©”ì‹œì§€ë¥¼ ë³€ì¡° ê°€ëŠ¥
   - Agent A â†’ Agent Bì˜ ì§„ì •í•œ ì¢…ë‹¨ê°„ ë³´ì•ˆì´ ë³´ì¥ë˜ì§€ ì•ŠìŒ

2. ì‹ ì› ê²€ì¦ì˜ í•œê³„
   TLS ì¸ì¦ì„œì˜ ë¬¸ì œ:
   - TLSëŠ” "ì„œë²„"ì˜ ì‹ ì›ë§Œ í™•ì¸ (ë„ë©”ì¸ ì†Œìœ ê¶Œ)
   - "ìš”ì²­ì„ ë³´ë‚¸ ì‚¬ëŒ"ì´ ëˆ„êµ¬ì¸ì§€ëŠ” ì¦ëª… ëª»í•¨
   - í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œëŠ” ë¸Œë¼ìš°ì €/í™˜ê²½ì—ì„œ ì„¤ì •ì´ ì–´ë ¤ì›€
   - AI ì—ì´ì „íŠ¸ ê°„ ì–‘ë°©í–¥ ì‹ ì› í™•ì¸ í•„ìš”ì„±ì„ ì¶©ì¡± ëª»í•¨

3. ì¤‘ê°„ ì„œë²„ í™˜ê²½ì˜ í˜„ì‹¤
   ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½:
   Agent A â†’ [ë°©í™”ë²½] â†’ [ë¡œë“œë°¸ëŸ°ì„œ] â†’ [API ê²Œì´íŠ¸ì›¨ì´]
           â†’ [í”„ë¡ì‹œ] â†’ [ìºì‹œ] â†’ Agent B

   - ê° ì¤‘ê°„ ì„œë²„ì—ì„œ TLS ì¬ì•”í˜¸í™” í•„ìš”
   - ëª¨ë“  ì¤‘ê°„ ì„œë²„ë¥¼ ì‹ ë¢°í•´ì•¼ í•¨ (Single Point of Trust ë¬¸ì œ)
   - í•˜ë‚˜ì˜ ì¤‘ê°„ ì„œë²„ë¼ë„ í•´í‚¹ë˜ë©´ ì „ì²´ í†µì‹  ë…¸ì¶œ

4. ë¹„íŠ¸ë‹¨ìœ„ ë©”ì‹œì§€ ë¬´ê²°ì„± ë¶ˆê°€ëŠ¥
   TLSì˜ ê²€ì¦ ë²”ìœ„:
   - TLSëŠ” ì „ì†¡ ê³„ì¸µ(Transport Layer)ë§Œ ë³´í˜¸
   - ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µì—ì„œì˜ ë©”ì‹œì§€ ë³€ì¡°ëŠ” íƒì§€ ëª»í•¨
   - ì˜ˆ: í”„ë¡ì‹œê°€ {"amount": 100}ì„ {"amount": 1000}ìœ¼ë¡œ ë³€ê²½
   - TLSëŠ” ì—¬ì „íˆ "ì•ˆì „í•œ ì—°ê²°"ì´ì§€ë§Œ ë©”ì‹œì§€ëŠ” ë³€ì¡°ë¨

5. ë¶€ì¸ë°©ì§€(Non-Repudiation) ë¶ˆê°€ëŠ¥
   ë²•ì /ê°ì‚¬ ë¬¸ì œ:
   - TLSëŠ” ëŒ€ì¹­í‚¤ ì•”í˜¸í™” ì‚¬ìš© (í•¸ë“œì…°ì´í¬ í›„)
   - "ëˆ„ê°€ ì´ ìš”ì²­ì„ ë³´ëƒˆëŠ”ì§€" ë‚˜ì¤‘ì— ì¦ëª… ë¶ˆê°€ëŠ¥
   - ë¶„ìŸ ë°œìƒ ì‹œ ë©”ì‹œì§€ ì¶œì²˜ ì…ì¦ ì–´ë ¤ì›€
   - ê°ì‚¬ ì¶”ì (Audit Trail) ì‹ ë¢°ì„± ë‚®ìŒ

ì‹¤ì œ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¹¨í•´ëœ ë¡œë“œë°¸ëŸ°ì„œë¥¼ í†µí•œ ê³µê²©                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ì‚¬ìš©ì â†’ "100 USDCë¥¼ Aliceì—ê²Œ ì „ì†¡"                   â”‚
â”‚ 2. TLSë¡œ ì•ˆì „í•˜ê²Œ ë¡œë“œë°¸ëŸ°ì„œ ë„ì°©                           â”‚
â”‚ 3. ë¡œë“œë°¸ëŸ°ì„œì—ì„œ TLS ë³µí˜¸í™” (í‰ë¬¸ ë…¸ì¶œ!)                   â”‚
â”‚ 4. ê³µê²©ìê°€ ë¡œë“œë°¸ëŸ°ì„œ ì œì–´ ì¤‘                              â”‚
â”‚ 5. ë©”ì‹œì§€ ë³€ì¡°: "1000 USDCë¥¼ Hackerì—ê²Œ ì „ì†¡"              â”‚
â”‚ 6. ìƒˆë¡œìš´ TLSë¡œ ë°±ì—”ë“œ ì„œë²„ì— ì „ì†¡                          â”‚
â”‚ 7. ë°±ì—”ë“œ ì„œë²„: "ì •ìƒì ì¸ TLS ìš”ì²­"ìœ¼ë¡œ ì¸ì‹                â”‚
â”‚ 8. ê²°ê³¼: ì‚¬ìš©ì ì˜ë„ì™€ ë‹¤ë¥¸ ê±°ë˜ ì‹¤í–‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì´ê²ƒì´ AI ì—ì´ì „íŠ¸ í†µì‹ ì— ì¹˜ëª…ì ì¸ ì´ìœ :
- AI ì—ì´ì „íŠ¸ëŠ” ìˆ˜ë°±~ìˆ˜ì²œ ê°œì˜ ì¤‘ê°„ ì„œë²„ë¥¼ ê±°ì¹  ìˆ˜ ìˆìŒ
- ê° ì¤‘ê°„ ì„œë²„ëŠ” ë‹¤ë¥¸ ì¡°ì§ì´ ìš´ì˜í•  ìˆ˜ ìˆìŒ
- ê¸ˆìœµ ê±°ë˜, ê³„ì•½ ì²´ê²° ë“± ì¤‘ìš”í•œ ê²°ì •ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰
- í•œë²ˆì˜ ë©”ì‹œì§€ ë³€ì¡°ë¡œ ìˆ˜ë°±ë§Œ ë‹¬ëŸ¬ ì†ì‹¤ ê°€ëŠ¥
```

**RFC 9421ì´ í•´ê²°í•˜ëŠ” ë°©ë²•**

RFC 9421 HTTP Message SignaturesëŠ” TLSì™€ëŠ” **ì™„ì „íˆ ë‹¤ë¥¸ ê³„ì¸µ**ì—ì„œ ë³´ì•ˆì„ ì œê³µí•©ë‹ˆë‹¤:

```
TLS vs RFC 9421 ë¹„êµ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TLS (ì „ì†¡ ê³„ì¸µ)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë³´í˜¸ ë²”ìœ„: ì—°ê²°(Connection)                               â”‚
â”‚ ë³´í˜¸ ëŒ€ìƒ: ì „ì†¡ ì¤‘ì¸ ë°ì´í„°                                â”‚
â”‚ ìƒëª…ì£¼ê¸°: ì—°ê²°ì´ ëŠì–´ì§€ë©´ ë                               â”‚
â”‚ ê²€ì¦ì: TLS ì¢…ë£Œ ì§€ì ê¹Œì§€ë§Œ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               vs
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RFC 9421 (ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë³´í˜¸ ë²”ìœ„: ë©”ì‹œì§€(Message)                                â”‚
â”‚ ë³´í˜¸ ëŒ€ìƒ: HTTP ìš”ì²­/ì‘ë‹µ ë‚´ìš©                             â”‚
â”‚ ìƒëª…ì£¼ê¸°: ë©”ì‹œì§€ê°€ ì¡´ì¬í•˜ëŠ” í•œ ì˜êµ¬ì                         â”‚
â”‚ ê²€ì¦ì: ìµœì¢… ìˆ˜ì‹ ì(ì§„ì§œ Agent B)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‹¤ì œ ë™ì‘ ë°©ì‹:
Agent Aê°€ ë©”ì‹œì§€ ì „ì†¡:
1. HTTP ìš”ì²­ ì‘ì„±
2. RFC 9421ë¡œ ë©”ì‹œì§€ ì„œëª… (Aì˜ ê°œì¸í‚¤)
3. TLSë¡œ ì•”í˜¸í™”í•˜ì—¬ ì „ì†¡
4. ì¤‘ê°„ ì„œë²„ë“¤ì„ ê±°ì¹¨ (TLS ì¢…ë£Œ/ì¬ì‹œì‘ ë°˜ë³µ)
5. ìµœì¢…ì ìœ¼ë¡œ Agent B ë„ì°©
6. Agent Bê°€ ì„œëª… ê²€ì¦ (Aì˜ ê³µê°œí‚¤)
   â†’ ì¤‘ê°„ ì„œë²„ì—ì„œ ë³€ì¡° ì—¬ë¶€ í™•ì¸ ê°€ëŠ¥!
   â†’ ì •ë§ Agent Aê°€ ë³´ë‚¸ ê²ƒì¸ì§€ í™•ì¸ ê°€ëŠ¥!
```

**í•´ê²°ì±…**: RFC 9421 í‘œì¤€ì— ë”°ë¥¸ ë©”ì‹œì§€ ì„œëª…

ì´ëŠ” TLS ìœ„ì— ì¶”ê°€ë˜ëŠ” **ë³´ì•ˆ ê³„ì¸µ**ìœ¼ë¡œ, ë‹¤ìŒì„ ë³´ì¥í•©ë‹ˆë‹¤:

- âœ… ì¤‘ê°„ ì„œë²„ë¥¼ ì‹ ë¢°í•˜ì§€ ì•Šì•„ë„ ë¨
- âœ… ë©”ì‹œì§€ ë³€ì¡° íƒì§€ ê°€ëŠ¥
- âœ… ë°œì‹ ì ì‹ ì› ì•”í˜¸í•™ì ìœ¼ë¡œ ì¦ëª…
- âœ… ë‚˜ì¤‘ì— ê°ì‚¬/ë¶„ìŸ í•´ê²° ê°€ëŠ¥

```
ì˜ˆì‹œ:
ì›ë³¸ HTTP ìš”ì²­:
POST /api/chat HTTP/1.1
Host: agent-b.example.com
Content-Type: application/json
{"message": "Hello"}

ì„œëª… ìƒì„± ê³¼ì •:
1. ì¤‘ìš”í•œ ë¶€ë¶„ë“¤ì„ ì¶”ì¶œ:
   - ë©”ì„œë“œ: POST
   - ê²½ë¡œ: /api/chat
   - í˜¸ìŠ¤íŠ¸: agent-b.example.com
   - ë‚´ìš©: {"message": "Hello"}

2. ì´ë“¤ì„ ì •ê·œí™”ëœ í˜•ì‹ìœ¼ë¡œ ê²°í•©

3. ê°œì¸í‚¤ë¡œ ì„œëª… ìƒì„±

4. ì„œëª…ì„ í—¤ë”ì— ì¶”ê°€:
   Signature: keyId="agent-a-key-123", algorithm="ed25519",
              signature="base64encodedSignature..."

5. ìˆ˜ì‹ ìê°€ ê³µê°œí‚¤ë¡œ ì„œëª… ê²€ì¦
```

**ì‹¤ì œ ì½”ë“œ ìœ„ì¹˜**: `/core/rfc9421/`

#### ê¸°ëŠ¥ 3: ë‹¤ì¤‘ ì²´ì¸ ì§€ì›

SAGEëŠ” ì—¬ëŸ¬ ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤:

| ë¸”ë¡ì²´ì¸           | ìƒíƒœ         | ìš©ë„               |
| ------------------ | ------------ | ------------------ |
| **Ethereum**       | âœ… ì™„ì „ ì§€ì› | ë©”ì¸ë„· í”„ë¡œë•ì…˜    |
| **Sepolia**        | âœ… í…ŒìŠ¤íŠ¸ë„·  | ê°œë°œ ë° í…ŒìŠ¤íŠ¸     |
| **Kaia (Cypress)** | âœ… ì™„ì „ ì§€ì› | í•œêµ­ ì¤‘ì‹¬ ë„¤íŠ¸ì›Œí¬ |
| **Kairos**         | âœ… í…ŒìŠ¤íŠ¸ë„·  | Kaia í…ŒìŠ¤íŠ¸ í™˜ê²½   |
| **Solana**         | ğŸš§ ê°œë°œ ì¤‘   | ê³ ì„±ëŠ¥ íŠ¸ëœì­ì…˜    |

**ì™œ ì—¬ëŸ¬ ì²´ì¸ì„ ì§€ì›í•˜ë‚˜?**

- ë‹¤ë¥¸ ë¹„ìš©: Ethereumì€ ë¹„ì‹¸ì§€ë§Œ ê°€ì¥ ì•ˆì „, KaiaëŠ” ì €ë ´í•˜ê³  ë¹ ë¦„
- ë‹¤ë¥¸ ì—ì½”ì‹œìŠ¤í…œ: ê° ì²´ì¸ë§ˆë‹¤ ë‹¤ë¥¸ ê°œë°œì ì»¤ë®¤ë‹ˆí‹°
- ì§€ì—­ì  ì„ í˜¸: KaiaëŠ” í•œêµ­ì—ì„œ ë§ì´ ì‚¬ìš©ë¨

#### ê¸°ëŠ¥ 4: í–¥ìƒëœ ë³´ì•ˆ

**ê³µê°œí‚¤ ì†Œìœ ê¶Œ ê²€ì¦**:

```
ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤:
ì•…ì˜ì ì¸ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ì‚¬ëŒì˜ ê³µê°œí‚¤ë¥¼ ìê¸° ê²ƒì´ë¼ê³  ë“±ë¡í•˜ë ¤ í•¨

SAGEì˜ í•´ê²°ì±…:
1. ê³µê°œí‚¤ë¥¼ ë“±ë¡í•  ë•Œ "ì±Œë¦°ì§€-ì‘ë‹µ" ê³¼ì • í•„ìš”
2. ì‹œìŠ¤í…œì´ ëœë¤ ë©”ì‹œì§€ë¥¼ ìƒì„±: "ì¦ëª…í•´ë³´ì„¸ìš”: XYZ123"
3. ì‚¬ìš©ìëŠ” ìì‹ ì˜ ê°œì¸í‚¤ë¡œ ì´ ë©”ì‹œì§€ì— ì„œëª…
4. ì‹œìŠ¤í…œì´ ê³µê°œí‚¤ë¡œ ì„œëª… ê²€ì¦
5. ê²€ì¦ ì„±ê³µ ì‹œì—ë§Œ ë“±ë¡ í—ˆìš©

ì½”ë“œ ìœ„ì¹˜: contracts/ethereum/contracts/SageRegistryV2.sol:148-166
```

**í‚¤ ì·¨ì†Œ ê¸°ëŠ¥**:

```
ë§Œì•½ ê°œì¸í‚¤ê°€ ë…¸ì¶œë˜ì—ˆë‹¤ë©´?
1. ì†Œìœ ìê°€ "í‚¤ ì·¨ì†Œ" íŠ¸ëœì­ì…˜ ì „ì†¡
2. ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì— ì·¨ì†Œ ê¸°ë¡
3. ì´í›„ í•´ë‹¹ í‚¤ë¡œ ì„œëª…ëœ ëª¨ë“  ë©”ì‹œì§€ ê±°ë¶€
4. ìƒˆ í‚¤ ìŒ ìƒì„± ë° ì¬ë“±ë¡

ì½”ë“œ ìœ„ì¹˜: contracts/ethereum/contracts/SageRegistryV2.sol (revokeKey í•¨ìˆ˜)
```

#### ê¸°ëŠ¥ 5: ë‹¤ì¤‘ ì•Œê³ ë¦¬ì¦˜ ì§€ì›

SAGEëŠ” 3ê°€ì§€ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì§€ì›í•©ë‹ˆë‹¤:

**1. Ed25519 (Edwards-curve Digital Signature Algorithm)**

```
ìš©ë„: ë””ì§€í„¸ ì„œëª… (ì‹ ì› í™•ì¸)
íŠ¹ì§•:
- ë§¤ìš° ë¹ ë¥¸ ì„œëª…/ê²€ì¦ ì†ë„
- ì‘ì€ í‚¤ í¬ê¸° (32ë°”ì´íŠ¸)
- ë†’ì€ ë³´ì•ˆì„±

ì‚¬ìš© ì˜ˆ:
- AI ì—ì´ì „íŠ¸ì˜ ì‹ ì› ì„œëª…
- DID ë¬¸ì„œ ì„œëª…
- ë©”ì‹œì§€ ì¸ì¦

ì½”ë“œ ìœ„ì¹˜: crypto/keys/ed25519.go
```

**2. Secp256k1 (Elliptic Curve)**

```
ìš©ë„: Ethereumê³¼ì˜ í˜¸í™˜ì„±
íŠ¹ì§•:
- Ethereumê³¼ Bitcoinì´ ì‚¬ìš©í•˜ëŠ” í‘œì¤€
- ECDSA ì„œëª…
- Ethereum ì£¼ì†Œ íŒŒìƒ

ì‚¬ìš© ì˜ˆ:
- Ethereum íŠ¸ëœì­ì…˜ ì„œëª…
- ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ìƒí˜¸ì‘ìš©
- Ethereum ê³„ì • ê´€ë¦¬

ì½”ë“œ ìœ„ì¹˜: crypto/keys/secp256k1.go
```

**3. X25519 (Curve25519)**

```
ìš©ë„: í‚¤ êµí™˜ (ì•”í˜¸í™” í‚¤ ê³µìœ )
íŠ¹ì§•:
- ì„œëª…ì´ ì•„ë‹Œ í‚¤ êµí™˜ ì „ìš©
- Diffie-Hellman í‚¤ êµí™˜
- Forward Secrecy ì œê³µ

ì‚¬ìš© ì˜ˆ:
- í•¸ë“œì…°ì´í¬ ì‹œ ì„ì‹œ í‚¤ êµí™˜
- ì„¸ì…˜ í‚¤ ìœ ë„
- HPKE ì•”í˜¸í™”

ì½”ë“œ ìœ„ì¹˜: crypto/keys/x25519.go
```

**ì•Œê³ ë¦¬ì¦˜ ë¹„êµí‘œ**:

| ê¸°ëŠ¥              | Ed25519      | Secp256k1   | X25519       |
| ----------------- | ------------ | ----------- | ------------ |
| **ì„œëª… ìƒì„±**     | âœ…           | âœ…          | âŒ           |
| **ì„œëª… ê²€ì¦**     | âœ…           | âœ…          | âŒ           |
| **í‚¤ êµí™˜**       | âŒ           | âŒ          | âœ…           |
| **ì•”í˜¸í™”**        | âš ï¸ (ë³€í™˜ í›„) | âŒ          | âœ…           |
| **í‚¤ í¬ê¸°**       | 32ë°”ì´íŠ¸     | 33/65ë°”ì´íŠ¸ | 32ë°”ì´íŠ¸     |
| **ì†ë„**          | âš¡ ë§¤ìš° ë¹ ë¦„ | ğŸš€ ë¹ ë¦„     | âš¡ ë§¤ìš° ë¹ ë¦„ |
| **Ethereum í˜¸í™˜** | âŒ           | âœ…          | âŒ           |

---

## 2. ì™œ SAGEê°€ í•„ìš”í•œê°€?

### 2.1 AI ì—ì´ì „íŠ¸ ì‹œëŒ€ì˜ ë³´ì•ˆ ë¬¸ì œ

**í˜„ì¬ ìƒí™©**:
2024-2025ë…„ í˜„ì¬, AI ì—ì´ì „íŠ¸ë“¤ì´ í­ë°œì ìœ¼ë¡œ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤:

- ChatGPT, Claude ê°™ì€ ëŒ€í™”í˜• AI
- ìë™í™”ëœ ê±°ë˜ ë´‡
- ì½”ë“œ ì‘ì„± ì—ì´ì „íŠ¸
- ë°ì´í„° ë¶„ì„ ì—ì´ì „íŠ¸

**ë¬¸ì œì **:

```
ì‹œë‚˜ë¦¬ì˜¤ 1: ì‹ ì› ì‚¬ì¹­
ì•…ì˜ì ì¸ ì—ì´ì „íŠ¸ Cê°€ í•©ë²•ì ì¸ ì—ì´ì „íŠ¸ Bì¸ ì²™ í•¨
â†’ ì—ì´ì „íŠ¸ Aê°€ Cì—ê²Œ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ë³´ëƒ„
â†’ ì •ë³´ ìœ ì¶œ!

ì‹œë‚˜ë¦¬ì˜¤ 2: ì¤‘ê°„ì ê³µê²© (Man-in-the-Middle)
ì—ì´ì „íŠ¸ A â†â†’ [ê³µê²©ì] â†â†’ ì—ì´ì „íŠ¸ B
â†’ ê³µê²©ìê°€ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ê°€ë¡œì±„ê³  ìˆ˜ì • ê°€ëŠ¥

ì‹œë‚˜ë¦¬ì˜¤ 3: ì¬ìƒ ê³µê²© (Replay Attack)
ê³µê²©ìê°€ ê³¼ê±°ì— ë³´ë‚¸ í•©ë²•ì ì¸ ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ë³´ëƒ„
â†’ ê°™ì€ ì‘ì—…ì´ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰ë¨ (ì˜ˆ: ëˆ ì†¡ê¸ˆ)
```

### 2.2 SAGEì˜ í•´ê²° ë°©ë²•

#### í•´ê²°ì±… 1: ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ì‹ ì› ê´€ë¦¬ (DID)

**Decentralized Identifier (DID)**:

```
ê°œë…:
- ë¸”ë¡ì²´ì¸ì— ê° AI ì—ì´ì „íŠ¸ì˜ ì‹ ì› ì •ë³´ ì €ì¥
- ì¤‘ì•™ ì„œë²„ ì—†ì´ ëˆ„êµ¬ë‚˜ ê²€ì¦ ê°€ëŠ¥
- í•œë²ˆ ë“±ë¡ë˜ë©´ ë³€ì¡° ë¶ˆê°€ëŠ¥

ì˜ˆì‹œ DID:
did:sage:ethereum:0x1234567890abcdef...

êµ¬ì¡° ì„¤ëª…:
- did: DID í‘œì¤€ í”„ë¡œí† ì½œ
- sage: SAGE ì‹œìŠ¤í…œ
- ethereum: Ethereum ë¸”ë¡ì²´ì¸
- 0x1234...: ê³ ìœ  ì‹ë³„ì (Ethereum ì£¼ì†Œ)
```

**DID ë“±ë¡ ê³¼ì •** (ì´ˆë³´ììš© ì„¤ëª…):

1. **í‚¤ ìŒ ìƒì„±**:

```bash
# ëª…ë ¹ì–´ ì‹¤í–‰
./sage-crypto generate -t ed25519 -o agent-key.pem

ë‚´ë¶€ ë™ì‘:
1. ëœë¤í•œ 256ë¹„íŠ¸ ìˆ«ì ìƒì„± (ê°œì¸í‚¤)
2. ìˆ˜í•™ ê³µì‹ìœ¼ë¡œ ê³µê°œí‚¤ ê³„ì‚°
3. íŒŒì¼ë¡œ ì•ˆì „í•˜ê²Œ ì €ì¥

ê²°ê³¼:
- agent-key.pem (ê°œì¸í‚¤ - ì ˆëŒ€ ê³µìœ í•˜ë©´ ì•ˆë¨!)
- agent-key.pub (ê³µê°œí‚¤ - ê³µê°œí•´ë„ ë¨)
```

2. **ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì— ë“±ë¡**:

```bash
./sage-did register \
  --chain ethereum \
  --key agent-key.pem \
  --name "My AI Agent" \
  --endpoint "https://my-agent.com/api" \
  --capabilities "chat,code,analysis"

ë‚´ë¶€ ë™ì‘:
1. ê³µê°œí‚¤ ì½ê¸°
2. ì†Œìœ ê¶Œ ì¦ëª…ì„ ìœ„í•œ ì„œëª… ìƒì„±
3. Ethereum íŠ¸ëœì­ì…˜ ìƒì„±:
   - í•¨ìˆ˜: registerAgent()
   - íŒŒë¼ë¯¸í„°: name, endpoint, publicKey, signature
4. íŠ¸ëœì­ì…˜ ì „ì†¡ (ê°€ìŠ¤ë¹„ ì§€ë¶ˆ)
5. ë¸”ë¡ì²´ì¸ì— ì˜êµ¬ ê¸°ë¡

ê²°ê³¼:
- DID ìƒì„±: did:sage:ethereum:0x...
- ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥í•œ ê³µê°œ ì •ë³´:
  * ì´ë¦„: "My AI Agent"
  * ì—”ë“œí¬ì¸íŠ¸: "https://my-agent.com/api"
  * ê³µê°œí‚¤: 0x1234...
  * ê¸°ëŠ¥: ["chat", "code", "analysis"]
```

3. **DID ì¡°íšŒ ë° ê²€ì¦**:

```bash
./sage-did resolve did:sage:ethereum:0x...

ë‚´ë¶€ ë™ì‘:
1. Ethereum ë…¸ë“œì— ì—°ê²°
2. ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì½ê¸° (getAgent í•¨ìˆ˜ í˜¸ì¶œ)
3. ë¸”ë¡ì²´ì¸ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
4. JSON í˜•ì‹ìœ¼ë¡œ íŒŒì‹±

ë°˜í™˜ ë°ì´í„°:
{
  "did": "did:sage:ethereum:0x...",
  "name": "My AI Agent",
  "endpoint": "https://my-agent.com/api",
  "publicKey": "0x1234...",
  "capabilities": ["chat", "code", "analysis"],
  "active": true,
  "owner": "0xOwnerAddress..."
}
```

#### í•´ê²°ì±… 2: ì™„ë²½í•œ Forward Secrecy

**Forward Secrecyë€?**

```
ë¹„ìœ :
ë§¤ì¼ ìƒˆë¡œìš´ ìë¬¼ì‡ ë¡œ ë°”ê¾¸ëŠ” ì§‘

ì¼ë°˜ ì•”í˜¸í™”:
í•˜ë‚˜ì˜ ì—´ì‡ ë¡œ ëª¨ë“  ë©”ì‹œì§€ ì•”í˜¸í™”
â†’ ì—´ì‡  ë…¸ì¶œ ì‹œ ê³¼ê±° ë©”ì‹œì§€ ì „ë¶€ ë…¸ì¶œ!

Forward Secrecy:
ê° ì„¸ì…˜ë§ˆë‹¤ ë‹¤ë¥¸ ì„ì‹œ ì—´ì‡  ì‚¬ìš©
â†’ í•˜ë‚˜ì˜ ì—´ì‡ ê°€ ë…¸ì¶œë˜ì–´ë„ ë‹¤ë¥¸ ì„¸ì…˜ì€ ì•ˆì „
â†’ ì„ì‹œ ì—´ì‡ ëŠ” ì‚¬ìš© í›„ ì¦‰ì‹œ íê¸°
```

**SAGEì˜ êµ¬í˜„**:

```
í•¸ë“œì…°ì´í¬ ê³¼ì •:
1. Aê°€ ì„ì‹œ X25519 í‚¤ ìŒ ìƒì„±
   ì„ì‹œ_ê°œì¸í‚¤_A, ì„ì‹œ_ê³µê°œí‚¤_A

2. Bê°€ ì„ì‹œ X25519 í‚¤ ìŒ ìƒì„±
   ì„ì‹œ_ê°œì¸í‚¤_B, ì„ì‹œ_ê³µê°œí‚¤_B

3. ì„ì‹œ ê³µê°œí‚¤ êµí™˜

4. ê°ì ê³µìœ  ë¹„ë°€ ê³„ì‚°:
   A: HPKE SetupBaseS(pkB, info) â†’ enc(ìº¡ìŠí™”), exporter(ê³µìœ  ë¹„ë°€).
   B: HPKE SetupBaseR(skB, enc, info) â†’ exporter(ê³µìœ  ë¹„ë°€, Clientì™€ ë™ì¼)

5. ê³µìœ  ë¹„ë°€ì—ì„œ ì„¸ì…˜ í‚¤ ìœ ë„:
   - exporterì—ì„œ HKDFë¡œ ë°©í–¥ë³„ í‚¤(c2s/s2c encÂ·sign) ìœ ë„ â†’ AEAD  (ChaCha20-Poly1305) ì´ˆê¸°í™”
   - kid â†” sessionID ë°”ì¸ë”© í›„ ì„¸ì…˜ ì‚¬ìš© ì‹œì‘

6. í†µì‹  ì¢…ë£Œ ì‹œ:
   - ëª¨ë“  ì„ì‹œ í‚¤ ì‚­ì œ
   - ì„¸ì…˜ í‚¤ ì‚­ì œ
   - ë©”ëª¨ë¦¬ì—ì„œ ì™„ì „íˆ ì§€ì›€ (0ìœ¼ë¡œ ë®ì–´ì“°ê¸°)

ê²°ê³¼:
- ë‚˜ì¤‘ì— ê°œì¸í‚¤ê°€ ë…¸ì¶œë˜ì–´ë„ ê³¼ê±° ì„¸ì…˜ ë³µí˜¸í™” ë¶ˆê°€ëŠ¥
- ê° ì„¸ì…˜ì€ ë…ë¦½ì ìœ¼ë¡œ ë³´í˜¸ë¨

```

#### í•´ê²°ì±… 3: ì¬ìƒ ê³µê²© ë°©ì§€ (Replay Protection)

**Nonce (Number used ONCE)**:

```
ê°œë…:
- í•œ ë²ˆë§Œ ì‚¬ìš©ë˜ëŠ” ì„ì˜ì˜ ìˆ«ì/ë¬¸ìì—´
- ê°™ì€ nonceë¥¼ ê°€ì§„ ë©”ì‹œì§€ëŠ” ê±°ë¶€

ì˜ˆì‹œ:
ìš”ì²­ 1: {"message": "ì†¡ê¸ˆ 100ë‹¬ëŸ¬", "nonce": "abc123"}
â†’ ì²˜ë¦¬ë¨

ìš”ì²­ 2: {"message": "ì†¡ê¸ˆ 100ë‹¬ëŸ¬", "nonce": "abc123"}
â†’ ê±°ë¶€! (ê°™ì€ nonce)

ìš”ì²­ 3: {"message": "ì†¡ê¸ˆ 100ë‹¬ëŸ¬", "nonce": "def456"}
â†’ ì²˜ë¦¬ë¨ (ìƒˆë¡œìš´ nonce)
```

**SAGEì˜ Nonce ê´€ë¦¬**:

```go
// ì½”ë“œ ìœ„ì¹˜: session/nonce.go

1. Nonce ìºì‹œ ìƒì„±:
   - ê° ì„¸ì…˜ë§ˆë‹¤ ë…ë¦½ì ì¸ nonce ì €ì¥ì†Œ
   - TTL (Time To Live) ì„¤ì • (ì˜ˆ: 5ë¶„)

2. ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ:
   func (nc *NonceCache) Check(nonce string) bool {
       if nc.seen[nonce] {
           return false  // ì´ë¯¸ ì‚¬ìš©ëœ nonce
       }
       nc.seen[nonce] = time.Now()
       return true  // ì²˜ìŒ ë³´ëŠ” nonce
   }

3. ìë™ ì²­ì†Œ:
   - 5ë¶„ë§ˆë‹¤ ì˜¤ë˜ëœ nonce ì‚­ì œ
   - ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± ìœ ì§€

ì½”ë“œ ìœ„ì¹˜: session/nonce.go:30-60
```

---

## 3. ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

### 3.1 ê³„ì¸µ êµ¬ì¡°

SAGEëŠ” 5ê°œì˜ ì£¼ìš” ê³„ì¸µìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Layer 5: Application Layer                     â”‚
â”‚         (AI ì—ì´ì „íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜)                          â”‚
â”‚                                                           â”‚
â”‚  ì˜ˆ: ì±—ë´‡, ê±°ë˜ ë´‡, ë¶„ì„ ì—ì´ì „íŠ¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Layer 4: Protocol Layer                        â”‚
â”‚         (í•¸ë“œì…°ì´í¬ ë° ì„¸ì…˜ í”„ë¡œí† ì½œ)                        â”‚
â”‚                                                           â”‚
â”‚  - 2ë‹¨ê³„ í•¸ë“œì…°ì´í¬                                        â”‚
â”‚  - ì„¸ì…˜ ìƒì„± ë° ê´€ë¦¬                                       â”‚
â”‚  - RFC 9421 ë©”ì‹œì§€ ì„œëª…                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Layer 3: Crypto Layer                          â”‚
â”‚         (ì•”í˜¸í™” ë° í‚¤ ê´€ë¦¬)                                â”‚
â”‚                                                           â”‚
â”‚  - Ed25519 ì„œëª…                                           â”‚
â”‚  - X25519 í‚¤ êµí™˜                                         â”‚
â”‚  - ChaCha20-Poly1305 ì•”í˜¸í™”                              â”‚
â”‚  - HKDF í‚¤ ìœ ë„                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Layer 2: Identity Layer                        â”‚
â”‚         (DID ë° ì‹ ì› ê´€ë¦¬)                                â”‚
â”‚                                                           â”‚
â”‚  - DID ë“±ë¡/ì¡°íšŒ/ì—…ë°ì´íŠ¸                                  â”‚
â”‚  - ê³µê°œí‚¤ ê²€ì¦                                            â”‚
â”‚  - ë‹¤ì¤‘ ì²´ì¸ ì§€ì›                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Layer 1: Blockchain Layer                      â”‚
â”‚         (ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë° ë¸”ë¡ì²´ì¸)                       â”‚
â”‚                                                           â”‚
â”‚  - Ethereum: SageRegistryV2                              â”‚
â”‚  - Kaia: SageRegistry                                    â”‚
â”‚  - Solana: (ê°œë°œ ì¤‘)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì»´í¬ë„ŒíŠ¸ ê°„ ìƒí˜¸ì‘ìš©

**ì‹œë‚˜ë¦¬ì˜¤: AI ì—ì´ì „íŠ¸ Aê°€ ì—ì´ì „íŠ¸ Bì—ê²Œ ë©”ì‹œì§€ ì „ì†¡**

```
ë‹¨ê³„ë³„ íë¦„:

1. ì´ˆê¸°í™” ë‹¨ê³„
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agent A â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ 1. DID ì¡°íšŒ ìš”ì²­
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  DID Resolver   â”‚ â† Ethereum/Kaia ë¸”ë¡ì²´ì¸ì—ì„œ ë°ì´í„° ì½ê¸°
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ 2. Agent Bì˜ ê³µê°œí‚¤ ë° ì—”ë“œí¬ì¸íŠ¸ ë°˜í™˜
        â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agent A â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. í•¸ë“œì…°ì´í¬ ë‹¨ê³„ (HPKE ê¸°ë°˜)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agent A â”‚                    â”‚ Agent B â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â”‚                              â”‚
        â”‚ Request (Aì˜ ì„ì‹œ í‚¤)          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                              â”‚
        â”‚ Response (Bì˜ ì„ì‹œ í‚¤)         â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚                              â”‚
        â”‚ Complete (ì„¸ì…˜ í™•ì •)          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                              â”‚
        â”‚ ACK (KeyID ë°œê¸‰)             â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚

3. ë³´ì•ˆ í†µì‹  ë‹¨ê³„
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agent A â”‚                    â”‚ Agent B â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â”‚ ì„¸ì…˜ í‚¤ë¡œ ì•”í˜¸í™”ëœ ë©”ì‹œì§€      â”‚
        â”‚ + RFC 9421 ì„œëª…              â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
        â”‚                              â”‚ 1. ì„œëª… ê²€ì¦
        â”‚                              â”‚ 2. ë³µí˜¸í™”
        â”‚                              â”‚ 3. ë©”ì‹œì§€ ì²˜ë¦¬
        â”‚                              â”‚
        â”‚ ì‘ë‹µ (ì•”í˜¸í™” + ì„œëª…)          â”‚
        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

---

## 4. í•µì‹¬ ê°œë… ì„¤ëª…

### 4.1 DID (Decentralized Identifier)

**DIDë€ ë¬´ì—‡ì¸ê°€?**

DIDëŠ” ì¤‘ì•™ ê¸°ê´€ ì—†ì´ ìê¸° ì£¼ê¶Œì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ë””ì§€í„¸ ì‹ ì›ì…ë‹ˆë‹¤.

**ì „í†µì ì¸ ì‹ ì› vs DID**:

```
ì „í†µì ì¸ ì‹ ì› (ì¤‘ì•™í™”):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì¤‘ì•™ ì„œë²„ (ì˜ˆ: Facebook, Google)    â”‚
â”‚   - ì‚¬ìš©ì ì •ë³´ ì €ì¥                  â”‚
â”‚   - ì‹ ì› ë°œê¸‰ ë° ê´€ë¦¬                 â”‚
â”‚   - ì ‘ê·¼ ê¶Œí•œ í†µì œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ ë¬¸ì œì :
           â”‚ 1. ì„œë²„ í•´í‚¹ ì‹œ ëª¨ë“  ì •ë³´ ìœ ì¶œ
           â”‚ 2. íšŒì‚¬ê°€ ë§í•˜ë©´ ì‹ ì› ì‚¬ë¼ì§
           â”‚ 3. ê°œì¸ ì •ë³´ í†µì œê¶Œ ì—†ìŒ
           â†“
    [ì‚¬ìš©ìë“¤...]

DID (íƒˆì¤‘ì•™í™”):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ë¸”ë¡ì²´ì¸ (Ethereum, Kaia ë“±)        â”‚
â”‚   - ê³µê°œí‚¤ë§Œ ì €ì¥                     â”‚
â”‚   - ë³€ì¡° ë¶ˆê°€ëŠ¥                       â”‚
â”‚   - 24/7 ê°€ìš©                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ ì¥ì :
           â”‚ 1. ê°œì¸í‚¤ ì†Œìœ ìë§Œ í†µì œ ê°€ëŠ¥
           â”‚ 2. ì˜êµ¬ì ìœ¼ë¡œ ì¡´ì¬
           â”‚ 3. ê¸€ë¡œë²Œí•˜ê²Œ ê²€ì¦ ê°€ëŠ¥
           â†“
    [ì‚¬ìš©ìë“¤...]
```

**SAGE DID êµ¬ì¡°**:

```
DID ì˜ˆì‹œ:
did:sage:ethereum:0x742d35Cc6634C0532925a3b844Bc454e4438f44e

íŒŒì‹± ê²°ê³¼:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ did           : DID í‘œì¤€ í”„ë¡œí† ì½œ            â”‚
â”‚ sage          : SAGE ë©”ì†Œë“œ                 â”‚
â”‚ ethereum      : Ethereum ë„¤íŠ¸ì›Œí¬            â”‚
â”‚ 0x742d35Cc... : Ethereum ì£¼ì†Œ (ì‹ë³„ì)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¸”ë¡ì²´ì¸ì— ì €ì¥ëœ ì‹¤ì œ ë°ì´í„°:
{
  "did": "did:sage:ethereum:0x742d35Cc...",
  "owner": "0x742d35Cc...",              // ì†Œìœ ì ì£¼ì†Œ
  "publicKey": "0x1234abcd...",          // Ed25519 ê³µê°œí‚¤
  "name": "Trading Bot Alpha",           // ì—ì´ì „íŠ¸ ì´ë¦„
  "description": "Automated trading",    // ì„¤ëª…
  "endpoint": "https://bot.example.com", // API ì—”ë“œí¬ì¸íŠ¸
  "capabilities": [                      // ê¸°ëŠ¥ ëª©ë¡
    "crypto-trading",
    "market-analysis",
    "risk-management"
  ],
  "active": true,                        // í™œì„± ìƒíƒœ
  "createdAt": 1704067200,              // ìƒì„± íƒ€ì„ìŠ¤íƒ¬í”„
  "updatedAt": 1704153600               // ì—…ë°ì´íŠ¸ íƒ€ì„ìŠ¤íƒ¬í”„
}
```

### 4.2 HPKE (Hybrid Public Key Encryption)

**HPKEë€?**

HPKEëŠ” ê³µê°œí‚¤ ì•”í˜¸í™”ì™€ ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ì˜ ì¥ì ì„ ê²°í•©í•œ ìµœì‹  ì•”í˜¸í™” í‘œì¤€ì…ë‹ˆë‹¤ (RFC 9180).

**ì™œ Hybridì¸ê°€?**

```
ê³µê°œí‚¤ ì•”í˜¸í™”ë§Œ ì‚¬ìš©:
ì¥ì : í‚¤ êµí™˜ ì•ˆì „
ë‹¨ì : ëŠë¦¼ (ëŒ€ìš©ëŸ‰ ë°ì´í„° ë¶€ì í•©)

ëŒ€ì¹­í‚¤ ì•”í˜¸í™”ë§Œ ì‚¬ìš©:
ì¥ì : ë§¤ìš° ë¹ ë¦„
ë‹¨ì : í‚¤ë¥¼ ì–´ë–»ê²Œ ì•ˆì „í•˜ê²Œ ê³µìœ ?

HPKE (ë‘ ê°€ì§€ ê²°í•©):
1. ê³µê°œí‚¤ ì•”í˜¸í™”ë¡œ ëŒ€ì¹­í‚¤ ê³µìœ 
2. ëŒ€ì¹­í‚¤ë¡œ ì‹¤ì œ ë°ì´í„° ì•”í˜¸í™”
â†’ ì•ˆì „í•˜ë©´ì„œë„ ë¹ ë¦„!
```

**SAGEì—ì„œì˜ HPKE ì‚¬ìš©**:

```
í•¸ë“œì…°ì´í¬ Request ë‹¨ê³„:

ë°œì‹ ì (Agent A):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì„ì‹œ X25519 í‚¤ ìŒ ìƒì„±             â”‚
â”‚    ephPrivA, ephPubA                 â”‚
â”‚                                      â”‚
â”‚ 2. Bì˜ ê³µê°œí‚¤ë¡œ HPKE ì„¤ì •             â”‚
â”‚    suite = KEM_X25519_HKDF_SHA256    â”‚
â”‚           + KDF_HKDF_SHA256          â”‚
â”‚           + AEAD_ChaCha20Poly1305    â”‚
â”‚                                      â”‚
â”‚ 3. ìº¡ìŠí™” (Encapsulation)            â”‚
â”‚    enc, ctx = Setup(B_pubKey)        â”‚
â”‚    - enc: ìº¡ìŠí™”ëœ í‚¤ (32ë°”ì´íŠ¸)      â”‚
â”‚    - ctx: ì•”í˜¸í™” ì»¨í…ìŠ¤íŠ¸             â”‚
â”‚                                      â”‚
â”‚ 4. ë©”ì‹œì§€ ì•”í˜¸í™”                      â”‚
â”‚    ciphertext = ctx.Seal(plaintext)  â”‚
â”‚                                      â”‚
â”‚ 5. íŒ¨í‚· ìƒì„±                          â”‚
â”‚    packet = enc || ciphertext        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ packet ì „ì†¡
           â†“
ìˆ˜ì‹ ì (Agent B):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. íŒ¨í‚· íŒŒì‹±                          â”‚
â”‚    enc = packet[0:32]                â”‚
â”‚    ciphertext = packet[32:]          â”‚
â”‚                                      â”‚
â”‚ 2. ìì‹ ì˜ ê°œì¸í‚¤ë¡œ HPKE ì„¤ì •          â”‚
â”‚    ctx = Setup(B_privKey, enc)       â”‚
â”‚                                      â”‚
â”‚ 3. ë³µí˜¸í™”                             â”‚
â”‚    plaintext = ctx.Open(ciphertext)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì½”ë“œ ìœ„ì¹˜: crypto/keys/x25519.go:354-423
```

### 4.3 ì„¸ì…˜ (Session)

**ì„¸ì…˜ì´ë€?**

ë‘ ì—ì´ì „íŠ¸ ê°„ì˜ ë³´ì•ˆ í†µì‹  ì±„ë„ì„ ì˜ë¯¸í•˜ë©°, í•¸ë“œì…°ì´í¬ë¥¼ í†µí•´ ìƒì„±ë©ë‹ˆë‹¤.

**ì„¸ì…˜ì˜ ìƒëª…ì£¼ê¸°**:

```
1. ìƒì„± (Creation)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ í•¸ë“œì…°ì´í¬ ì™„ë£Œ ì‹œ:                  â”‚
   â”‚                                     â”‚
   â”‚ ì…ë ¥:                                â”‚
   â”‚ - ê³µìœ  ë¹„ë°€ (sharedSecret)          â”‚
   â”‚ - ì»¨í…ìŠ¤íŠ¸ ID (contextID)           â”‚
   â”‚ - ì„ì‹œ ê³µê°œí‚¤ë“¤ (ephA, ephB)         â”‚
   â”‚                                     â”‚
   â”‚ ì²˜ë¦¬:                                â”‚
   â”‚ 1. ì„¸ì…˜ ì‹œë“œ ìœ ë„:                   â”‚
   â”‚    salt = SHA256(label + ctx + ephs)â”‚
   â”‚    seed = HKDF-Extract(secret, salt)â”‚
   â”‚                                     â”‚
   â”‚ 2. ì„¸ì…˜ ID ê³„ì‚°:                     â”‚
   â”‚    sid = Base64(SHA256(seed)[0:16]) â”‚
   â”‚                                     â”‚
   â”‚ 3. ë°©í–¥ë³„ í‚¤ ìœ ë„:                   â”‚
   â”‚    C2S_Enc = HKDF(seed, "c2s|enc")  â”‚
   â”‚    C2S_Sign = HKDF(seed, "c2s|sign")â”‚
   â”‚    S2C_Enc = HKDF(seed, "s2c|enc")  â”‚
   â”‚    S2C_Sign = HKDF(seed, "s2c|sign")â”‚
   â”‚                                     â”‚
   â”‚ ì¶œë ¥:                                â”‚
   â”‚ - SecureSession ê°ì²´                â”‚
   â”‚ - ì„¸ì…˜ ID                            â”‚
   â”‚ - ì•”í˜¸í™”/ì„œëª… í‚¤ë“¤                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. ì‚¬ìš© (Usage)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ë©”ì‹œì§€ ì „ì†¡:                         â”‚
   â”‚ plaintext â†’ Encrypt â†’ ciphertext    â”‚
   â”‚                                     â”‚
   â”‚ ì„œëª… ìƒì„±:                           â”‚
   â”‚ message â†’ HMAC-SHA256 â†’ signature   â”‚
   â”‚                                     â”‚
   â”‚ ë©”ì‹œì§€ ìˆ˜ì‹ :                         â”‚
   â”‚ ciphertext â†’ Decrypt â†’ plaintext    â”‚
   â”‚ signature â†’ Verify â†’ OK/FAIL        â”‚
   â”‚                                     â”‚
   â”‚ ìƒíƒœ ì—…ë°ì´íŠ¸:                       â”‚
   â”‚ - lastUsedAt ê°±ì‹                    â”‚
   â”‚ - messageCount ì¦ê°€                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. ë§Œë£Œ (Expiration)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ë§Œë£Œ ì¡°ê±´:                           â”‚
   â”‚                                     â”‚
   â”‚ 1. MaxAge ì´ˆê³¼                      â”‚
   â”‚    now > createdAt + MaxAge         â”‚
   â”‚    (ì˜ˆ: 1ì‹œê°„ í›„ ë¬´ì¡°ê±´ ë§Œë£Œ)         â”‚
   â”‚                                     â”‚
   â”‚ 2. IdleTimeout ì´ˆê³¼                 â”‚
   â”‚    now > lastUsedAt + IdleTimeout   â”‚
   â”‚    (ì˜ˆ: 10ë¶„ê°„ ì‚¬ìš© ì•ˆí•˜ë©´ ë§Œë£Œ)      â”‚
   â”‚                                     â”‚
   â”‚ 3. MaxMessages ì´ˆê³¼                 â”‚
   â”‚    messageCount >= MaxMessages      â”‚
   â”‚    (ì˜ˆ: 10000ê°œ ë©”ì‹œì§€ í›„ ë§Œë£Œ)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. ì •ë¦¬ (Cleanup)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Close() í˜¸ì¶œ ì‹œ:                     â”‚
   â”‚                                     â”‚
   â”‚ 1. ìƒíƒœ í”Œë˜ê·¸ ì„¤ì •                  â”‚
   â”‚    closed = true                    â”‚
   â”‚                                     â”‚
   â”‚ 2. í‚¤ ì¬ë£Œ ì•ˆì „ ì‚­ì œ                 â”‚
   â”‚    for i in range(len(key)):        â”‚
   â”‚        key[i] = 0                   â”‚
   â”‚                                     â”‚
   â”‚ 3. ëŒ€ìƒ í‚¤ë“¤:                        â”‚
   â”‚    - encryptKey                     â”‚
   â”‚    - signingKey                     â”‚
   â”‚    - sessionSeed                    â”‚
   â”‚    - outKey, inKey                  â”‚
   â”‚    - outSign, inSign                â”‚
   â”‚                                     â”‚
   â”‚ 4. ë§¤ë‹ˆì €ì—ì„œ ì œê±°                   â”‚
   â”‚    manager.Remove(sessionID)        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì½”ë“œ ìœ„ì¹˜: session/session.go
```

### 4.4 RFC 9421 (HTTP Message Signatures)

**RFC 9421ì´ë€?**

HTTP ë©”ì‹œì§€ì— ë””ì§€í„¸ ì„œëª…ì„ ì¶”ê°€í•˜ì—¬ ë¬´ê²°ì„±ê³¼ ì¶œì²˜ë¥¼ ë³´ì¥í•˜ëŠ” í‘œì¤€ì…ë‹ˆë‹¤.

**ì„œëª… ê³¼ì • ìƒì„¸ ì„¤ëª…**:

```
ì˜ˆì‹œ HTTP ìš”ì²­:
POST /api/chat HTTP/1.1
Host: agent-b.example.com
Content-Type: application/json
Content-Length: 28

{"message": "Hello, Agent B"}

ë‹¨ê³„ 1: ì„œëª…í•  ì»´í¬ë„ŒíŠ¸ ì„ íƒ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì„ íƒí•œ ì»´í¬ë„ŒíŠ¸ë“¤:                   â”‚
â”‚ - @method: POST                     â”‚
â”‚ - @authority: agent-b.example.com   â”‚
â”‚ - @path: /api/chat                  â”‚
â”‚ - content-type: application/json    â”‚
â”‚ - content-digest: SHA-256=...       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë‹¨ê³„ 2: ì •ê·œí™” (Canonicalization)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "@method": POST                     â”‚
â”‚ "@authority": agent-b.example.com   â”‚
â”‚ "@path": /api/chat                  â”‚
â”‚ "content-type": application/json    â”‚
â”‚ "content-digest": sha-256=:...      â”‚
â”‚ "@signature-params": ("@method" ... â”‚
â”‚   );created=1704067200              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ì½”ë“œ ìœ„ì¹˜: core/rfc9421/canonicalizer.go

ë‹¨ê³„ 3: ì„œëª… ìƒì„±
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ signatureInput = [ì •ê·œí™”ëœ ë¬¸ìì—´]    â”‚
â”‚                                     â”‚
â”‚ signature = Sign(                   â”‚
â”‚     privateKey,                     â”‚
â”‚     signatureInput                  â”‚
â”‚ )                                   â”‚
â”‚                                     â”‚
â”‚ signatureBase64 = Base64(signature) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ì½”ë“œ ìœ„ì¹˜: core/rfc9421/verifier.go:72-75

ë‹¨ê³„ 4: í—¤ë” ì¶”ê°€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Signature-Input: sig1=("@method" .. â”‚
â”‚   );created=1704067200;keyid="k1"  â”‚
â”‚                                     â”‚
â”‚ Signature: sig1=:signatureBase64:   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ìµœì¢… HTTP ìš”ì²­:
POST /api/chat HTTP/1.1
Host: agent-b.example.com
Content-Type: application/json
Content-Length: 28
Signature-Input: sig1=("@method" "@authority"
  "@path" "content-type" "content-digest");
  created=1704067200;keyid="agent-a-key-123"
Signature: sig1=:MEUCIQDx7+...base64...:

{"message": "Hello, Agent B"}
```

**ì„œëª… ê²€ì¦ ê³¼ì •**:

```
ìˆ˜ì‹ ì (Agent B):

1. Signature í—¤ë” íŒŒì‹±
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ keyid ì¶”ì¶œ: "agent-a-key-123"   â”‚
   â”‚ algorithm ì¶”ì¶œ: "ed25519"       â”‚
   â”‚ signature ì¶”ì¶œ: [base64 ë””ì½”ë“œ] â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. KeyIDë¡œ ì„¸ì…˜ ì¡°íšŒ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ session = manager.GetByKeyID(   â”‚
   â”‚     "agent-a-key-123"           â”‚
   â”‚ )                               â”‚
   â”‚                                 â”‚
   â”‚ ì„¸ì…˜ì—ì„œ ê²€ì¦ í‚¤ ê°€ì ¸ì˜¤ê¸°:        â”‚
   â”‚ verifyKey = session.inSign      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. ì„œëª… ë² ì´ìŠ¤ ì¬êµ¬ì„±
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Signature-Inputì— ëª…ì‹œëœ         â”‚
   â”‚ ì»´í¬ë„ŒíŠ¸ë“¤ì„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì •ê·œí™”  â”‚
   â”‚                                 â”‚
   â”‚ reconstructed = Canonicalize(   â”‚
   â”‚     request,                    â”‚
   â”‚     ["@method", "@authority"...]â”‚
   â”‚ )                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. ì„œëª… ê²€ì¦
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ valid = Verify(                 â”‚
   â”‚     verifyKey,                  â”‚
   â”‚     reconstructed,              â”‚
   â”‚     signature                   â”‚
   â”‚ )                               â”‚
   â”‚                                 â”‚
   â”‚ if !valid:                      â”‚
   â”‚     return ERROR                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. ì¶”ê°€ ê²€ì¦
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ - Timestamp í™•ì¸                â”‚
   â”‚   now - created < MaxSkew       â”‚
   â”‚                                 â”‚
   â”‚ - Nonce í™•ì¸ (ì¬ìƒ ê³µê²© ë°©ì§€)    â”‚
   â”‚   !nonces.Seen(nonce)           â”‚
   â”‚                                 â”‚
   â”‚ - ì„¸ì…˜ ë§Œë£Œ í™•ì¸                 â”‚
   â”‚   !session.IsExpired()          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì½”ë“œ ìœ„ì¹˜: core/rfc9421/verifier.go:46-70
```

---

## 5. í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„¸ ë¶„ì„

### 5.1 ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
sage/
â”œâ”€â”€ cmd/                      # ì‹¤í–‰ ê°€ëŠ¥í•œ CLI ë„êµ¬ë“¤
â”‚   â”œâ”€â”€ sage-crypto/         # ì•”í˜¸í™” í‚¤ ê´€ë¦¬ CLI
â”‚   â”‚   â”œâ”€â”€ main.go          # ì§„ì…ì 
â”‚   â”‚   â”œâ”€â”€ generate.go      # í‚¤ ìƒì„± ëª…ë ¹ì–´
â”‚   â”‚   â”œâ”€â”€ sign.go          # ì„œëª… ëª…ë ¹ì–´
â”‚   â”‚   â”œâ”€â”€ verify.go        # ê²€ì¦ ëª…ë ¹ì–´
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ sage-did/            # DID ê´€ë¦¬ CLI
â”‚   â”‚   â”œâ”€â”€ main.go          # ì§„ì…ì 
â”‚   â”‚   â”œâ”€â”€ register.go      # DID ë“±ë¡
â”‚   â”‚   â”œâ”€â”€ resolve.go       # DID ì¡°íšŒ
â”‚   â”‚   â”œâ”€â”€ update.go        # DID ì—…ë°ì´íŠ¸
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ sage-verify/         # ë©”ì‹œì§€ ê²€ì¦ CLI
â”‚       â””â”€â”€ main.go
â”‚
â”œâ”€â”€ core/                    # í•µì‹¬ í”„ë¡œí† ì½œ êµ¬í˜„
â”‚   â”œâ”€â”€ rfc9421/            # RFC 9421 HTTP ì„œëª…
â”‚   â”‚   â”œâ”€â”€ canonicalizer.go # ë©”ì‹œì§€ ì •ê·œí™”
â”‚   â”‚   â”œâ”€â”€ verifier.go      # ì„œëª… ìƒì„±/ê²€ì¦
â”‚   â”‚   â”œâ”€â”€ parser.go        # ì„œëª… í—¤ë” íŒŒì‹±
â”‚   â”‚   â””â”€â”€ types.go         # ë°ì´í„° êµ¬ì¡°
â”‚   â”‚
â”‚   â””â”€â”€ message/            # ë©”ì‹œì§€ ì²˜ë¦¬
â”‚       â”œâ”€â”€ validator/       # ë©”ì‹œì§€ ê²€ì¦
â”‚       â”œâ”€â”€ order/          # ë©”ì‹œì§€ ìˆœì„œ ê´€ë¦¬
â”‚       â”œâ”€â”€ nonce/          # Nonce ê´€ë¦¬
â”‚       â””â”€â”€ dedupe/         # ì¤‘ë³µ ì œê±°
â”‚
â”œâ”€â”€ crypto/                  # ì•”í˜¸í™” ëª¨ë“ˆ
â”‚   â”œâ”€â”€ keys/               # í‚¤ ìŒ êµ¬í˜„
â”‚   â”‚   â”œâ”€â”€ ed25519.go      # Ed25519 ì„œëª… í‚¤
â”‚   â”‚   â”œâ”€â”€ secp256k1.go    # Ethereum í˜¸í™˜ í‚¤
â”‚   â”‚   â”œâ”€â”€ x25519.go       # í‚¤ êµí™˜ìš©
â”‚   â”‚   â””â”€â”€ constructors.go # íŒ©í† ë¦¬ í•¨ìˆ˜ë“¤
â”‚   â”‚
â”‚   â”œâ”€â”€ chain/              # ë¸”ë¡ì²´ì¸ë³„ ì•”í˜¸í™”
â”‚   â”‚   â”œâ”€â”€ ethereum/       # Ethereum êµ¬í˜„
â”‚   â”‚   â””â”€â”€ solana/         # Solana êµ¬í˜„
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/            # í‚¤ ì €ì¥ì†Œ
â”‚   â”‚   â”œâ”€â”€ file.go         # íŒŒì¼ ê¸°ë°˜
â”‚   â”‚   â””â”€â”€ memory.go       # ë©”ëª¨ë¦¬ ê¸°ë°˜
â”‚   â”‚
â”‚   â”œâ”€â”€ vault/              # í•˜ë“œì›¨ì–´ ë³´ì•ˆ
â”‚   â”‚   â””â”€â”€ secure_storage.go # OS í‚¤ì²´ì¸ í†µí•©
â”‚   â”‚
â”‚   â””â”€â”€ formats/            # í‚¤ í¬ë§· ë³€í™˜
â”‚       â”œâ”€â”€ jwk.go          # JSON Web Key
â”‚       â””â”€â”€ pem.go          # PEM í¬ë§·
â”‚
â”œâ”€â”€ did/                     # íƒˆì¤‘ì•™í™” ì‹ ì›
â”‚   â”œâ”€â”€ manager.go          # DID í†µí•© ê´€ë¦¬ì
â”‚   â”œâ”€â”€ resolver.go         # DID ë¬¸ì„œ ì¡°íšŒ
â”‚   â”œâ”€â”€ registry.go         # DID ë“±ë¡/ì—…ë°ì´íŠ¸
â”‚   â”œâ”€â”€ verification.go     # DID ê²€ì¦
â”‚   â”‚
â”‚   â”œâ”€â”€ ethereum/           # Ethereum DID í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ client.go       # ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ìƒí˜¸ì‘ìš©
â”‚   â”‚   â”œâ”€â”€ resolver.go     # Ethereum DID ì¡°íšŒ
â”‚   â”‚   â””â”€â”€ abi.go          # ì»¨íŠ¸ë™íŠ¸ ABI ë°”ì¸ë”©
â”‚   â”‚
â”‚   â””â”€â”€ solana/             # Solana DID í´ë¼ì´ì–¸íŠ¸
â”‚       â”œâ”€â”€ client.go
â”‚       â””â”€â”€ resolver.go
â”‚
â”œâ”€â”€ handshake/               # ë³´ì•ˆ í•¸ë“œì…°ì´í¬
â”‚   â”œâ”€â”€ client.go           # ìš”ì²­ ì¸¡ êµ¬í˜„
â”‚   â”œâ”€â”€ server.go           # ì‘ë‹µ ì¸¡ êµ¬í˜„
â”‚   â”œâ”€â”€ types.go            # ë©”ì‹œì§€ íƒ€ì…ë“¤
â”‚   â””â”€â”€ utils.go            # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚
â”œâ”€â”€ session/                 # ì„¸ì…˜ ê´€ë¦¬
â”‚   â”œâ”€â”€ manager.go          # ì„¸ì…˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬
â”‚   â”œâ”€â”€ session.go          # SecureSession êµ¬í˜„
â”‚   â”œâ”€â”€ nonce.go            # ì¬ìƒ ê³µê²© ë°©ì§€
â”‚   â”œâ”€â”€ metadata.go         # ì„¸ì…˜ ë©”íƒ€ë°ì´í„°
â”‚   â””â”€â”€ types.go            # ì¸í„°í˜ì´ìŠ¤ ì •ì˜
â”‚
â”œâ”€â”€ hpke/                    # HPKE ì•”í˜¸í™”
â”‚   â”œâ”€â”€ client.go           # ì†¡ì‹ ì (Sender)
â”‚   â”œâ”€â”€ server.go           # ìˆ˜ì‹ ì (Receiver)
â”‚   â””â”€â”€ common.go           # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”‚
â”œâ”€â”€ contracts/               # ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸
â”‚   â””â”€â”€ ethereum/
â”‚       â”œâ”€â”€ contracts/       # Solidity ì†ŒìŠ¤ì½”ë“œ
â”‚       â”‚   â”œâ”€â”€ SageRegistryV2.sol  # V2 ë ˆì§€ìŠ¤íŠ¸ë¦¬
â”‚       â”‚   â”œâ”€â”€ interfaces/         # ì¸í„°í˜ì´ìŠ¤ë“¤
â”‚       â”‚   â””â”€â”€ test/              # í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë™íŠ¸
â”‚       â”‚
â”‚       â”œâ”€â”€ scripts/         # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”‚       â”‚   â”œâ”€â”€ deploy.js
â”‚       â”‚   â””â”€â”€ verify.js
â”‚       â”‚
â”‚       â””â”€â”€ test/            # Hardhat í…ŒìŠ¤íŠ¸
â”‚           â””â”€â”€ SageRegistryV2.test.js
â”‚
â”œâ”€â”€ config/                  # ì„¤ì • ê´€ë¦¬
â”‚   â”œâ”€â”€ config.go           # í†µí•© ì„¤ì • ë¡œë”
â”‚   â”œâ”€â”€ blockchain.go       # ë¸”ë¡ì²´ì¸ ì„¤ì •
â”‚   â””â”€â”€ validator.go        # ì„¤ì • ê²€ì¦
â”‚
â”œâ”€â”€ health/                  # í—¬ìŠ¤ ì²´í¬
â”‚   â”œâ”€â”€ checker.go          # ì»´í¬ë„ŒíŠ¸ ìƒíƒœ í™•ì¸
â”‚   â””â”€â”€ server.go           # HTTP ì—”ë“œí¬ì¸íŠ¸
â”‚
â”œâ”€â”€ examples/                # ì‚¬ìš© ì˜ˆì œ
â”‚   â””â”€â”€ mcp-integration/    # MCP í†µí•© ì˜ˆì œ
â”‚       â”œâ”€â”€ basic-demo/     # ê¸°ë³¸ ë°ëª¨
â”‚       â”œâ”€â”€ basic-tool/     # ë„êµ¬ í†µí•©
â”‚       â””â”€â”€ vulnerable-vs-secure/  # ë³´ì•ˆ ë¹„êµ
â”‚
â”œâ”€â”€ tests/                   # í…ŒìŠ¤íŠ¸ ì½”ë“œ
â”‚   â”œâ”€â”€ integration/        # í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ random/             # ë¬´ì‘ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ handshake/          # í•¸ë“œì…°ì´í¬ í…ŒìŠ¤íŠ¸
â”‚
â”œâ”€â”€ docs/                    # ë¬¸ì„œ
â”‚   â”œâ”€â”€ handshake/          # í•¸ë“œì…°ì´í¬ ë¬¸ì„œ
â”‚   â”œâ”€â”€ dev/                # ê°œë°œì ê°€ì´ë“œ
â”‚   â””â”€â”€ assets/             # ë‹¤ì´ì–´ê·¸ë¨ ë“±
â”‚
â”œâ”€â”€ scripts/                 # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ deploy-sage.sh      # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”‚
â””â”€â”€ internal/                # ë‚´ë¶€ ìœ í‹¸ë¦¬í‹°
    â””â”€â”€ utils/
```

### 5.2 ì£¼ìš” íŒŒì¼ ì„¤ëª…

#### 5.2.1 ì•”í˜¸í™” í‚¤ ê´€ë¦¬

**crypto/keys/ed25519.go** (87ì¤„)

```go
// Ed25519 í‚¤ ìŒ êµ¬ì¡°ì²´
type ed25519KeyPair struct {
    privateKey ed25519.PrivateKey  // 64ë°”ì´íŠ¸
    publicKey  ed25519.PublicKey   // 32ë°”ì´íŠ¸
    id         string               // 16ì§„ìˆ˜ ì‹ë³„ì
}

// í•µì‹¬ ê¸°ëŠ¥:
1. GenerateEd25519KeyPair()
   - ì•”í˜¸í•™ì ìœ¼ë¡œ ì•ˆì „í•œ ë‚œìˆ˜ ìƒì„±ê¸° ì‚¬ìš©
   - ê³µê°œí‚¤ í•´ì‹œì˜ ì²« 8ë°”ì´íŠ¸ë¡œ ID ìƒì„±

2. Sign(message []byte)
   - ë©”ì‹œì§€ì— ëŒ€í•œ 64ë°”ì´íŠ¸ ì„œëª… ìƒì„±
   - ê²°ì •ë¡ ì  (ê°™ì€ ë©”ì‹œì§€ = ê°™ì€ ì„œëª…)

3. Verify(message, signature []byte)
   - ê³µê°œí‚¤ë¡œ ì„œëª… ê²€ì¦
   - O(1) ì‹œê°„ ë³µì¡ë„

ìœ„ì¹˜: /crypto/keys/ed25519.go:1-88
```

**crypto/keys/x25519.go** (550ì¤„)

```go
// X25519 í‚¤ ìŒ êµ¬ì¡°ì²´
type X25519KeyPair struct {
    privateKey *ecdh.PrivateKey  // 32ë°”ì´íŠ¸
    publicKey  *ecdh.PublicKey   // 32ë°”ì´íŠ¸
    id         string
}

// í•µì‹¬ ê¸°ëŠ¥:
1. DeriveSharedSecret(peerPubBytes []byte)
   - ECDHë¡œ ê³µìœ  ë¹„ë°€ ê³„ì‚°
   - SHA-256 í•´ì‹±

2. EncryptWithEd25519Peer(edPeerPub, plaintext)
   - Ed25519 í‚¤ë¥¼ X25519ë¡œ ë³€í™˜
   - HKDFë¡œ í‚¤ ìœ ë„
   - AES-256-GCMìœ¼ë¡œ ì•”í˜¸í™”

3. DecryptWithEd25519Peer(privateKey, packet)
   - ì—­ê³¼ì •ìœ¼ë¡œ ë³µí˜¸í™”

4. HPKE í—¬í¼ í•¨ìˆ˜ë“¤:
   - HPKEDeriveSharedSecretToX25519Peer()
   - HPKEOpenSharedSecretWithX25519Priv()
   - HPKESealAndExportToX25519Peer()

ìœ„ì¹˜: /crypto/keys/x25519.go:1-550
```

#### 5.2.2 í•¸ë“œì…°ì´í¬ êµ¬í˜„

**ì „ì²´íë¦„**

```
Client.Initialize()
   â””â”€ HPKE ì†¡ì‹ ì(setupBaseS): enc, exporter ìƒì„±
   â””â”€ Init(payload={enc, info, exportCtx, nonce, ts, initDID, respDID}) ì „ì†¡(+Ed25519 ì„œëª…)
   â””â”€ Ack ìˆ˜ì‹ (meta={kid, ackTagB64, ts})
   â””â”€ HMAC(exporter, ctxID|nonce|kid) == ackTag ? ì„¸ì…˜ ê³ ì • & kid ë°”ì¸ë”© : ì‹¤íŒ¨

Server.SendMessage()
   â””â”€ ë©”íƒ€ ì„œëª… ê²€ì¦ & DID ì¡°íšŒ
   â””â”€ timestamp ìŠ¤í/nonce ì¬ì‚¬ìš© ì²´í¬
   â””â”€ info/exportCtx ì •í•©ì„± í™•ì¸
   â””â”€ HPKE ìˆ˜ì‹ ì(setupBaseR): exporter ë³µì›
   â””â”€ ì„¸ì…˜ ìƒì„±(initiator=false), kid ë°œê¸‰/ë°”ì¸ë”©
   â””â”€ ackTag=HMAC(exporter, ctxID|nonce|kid) ë§Œë“¤ì–´ Ack ë°˜í™˜

```

**hpke/client.go** (152ì¤„)

```go
// í´ë¼ì´ì–¸íŠ¸ (ìš”ì²­ ì¸¡) êµ¬ì¡°ì²´
type Client struct {
    a2a.A2AServiceClient          // gRPC A2A ìŠ¤í…
    signer   sagecrypto.KeyPair    // Ed25519(ë©”íƒ€ë°ì´í„° ì„œëª…)
    did      string                // í´ë¼ì´ì–¸íŠ¸ DID
    resolver did.Resolver          // í”¼ì–´ DID â†’ HPKE ê³µê°œí‚¤ ì¡°íšŒ
    info     InfoBuilder           // info/exportCtx ë¹Œë”
    sessMgr  *session.Manager      // ì„¸ì…˜ ê´€ë¦¬ì (í‚¤ ë°”ì¸ë”©)
}
```

**ì£¼ìš” ë©”ì„œë“œ**:
`Initialize(ctx context.Context, ctxID, initDID, peerDID string)`

Init ì „ì†¡ â†’ Ack ê²€ì¦ â†’ ì„¸ì…˜ ìƒì„± â†’ kid ë°”ì¸ë”©ê¹Œì§€ ëë‚´ëŠ” ì—”íŠ¸ë¦¬í¬ì¸íŠ¸

1. peerDIDì˜ HPKE ê³µê°œí‚¤(X25519) ì¡°íšŒ
2. info/exportCtx ë¹Œë“œ
3. HPKE Base(ì†¡ì‹ ì) â†’ enc, exporter(32B) ìƒì„±
4. ë¡œì»¬ ì„¸ì…˜ ì„ ìƒì„±: EnsureSessionFromExporterWithRole(exporter, "sage/hpke v1", initiator=true)
5. nonce, ts, enc(B64) ë‹´ì•„ A2A Init ì „ì†¡(ê²°ì •ë¡  ì§ë ¬í™” â†’ Ed25519 ì„œëª… ë©”íƒ€)
6. Ack(meta) ìˆ˜ì‹  í›„ kid, ackTagB64 ì¶”ì¶œ
7. ê²€ì¦: expect = HMAC(exporter, ctxID|nonce|kid) == ackTag
8. OKë©´ kid â†’ sessionID ë°”ì¸ë”©, kid ë¦¬í„´

```go
// ì„œë²„ (ì‘ë‹µ ì¸¡) êµ¬ì¡°ì²´
type Server struct {
    a2a.UnimplementedA2AServiceServer

    // HPKE ìˆ˜ì‹  ì •ì  í‚¤ìŒ(X25519) â€” enc ë³µí˜¸í™”ì— ì‚¬ìš©
    hpkePriv keys.X25519KeyPair

    did       string
    resolver  did.Resolver
    sessMgr   *session.Manager
    nonces    *session.NonceCache   // ì¬ìƒ ê³µê²© ë°©ì§€
    maxSkew   time.Duration         // ì‹œê³„ ì˜¤ì°¨ í—ˆìš©
    info      InfoBuilder
}
```

**ì£¼ìš” ë©”ì„œë“œ**:
`SendMessage(ctx, in *a2a.SendMessageRequest)`

Init ì²˜ë¦¬ ì—”íŠ¸ë¦¬í¬ì¸íŠ¸: ì„œëª…/ì‹œê°/nonce ê²€ì¦ â†’ HPKE Base ìˆ˜ì‹ ì(setupR)ë¡œ exporter íšë“ â†’ ì„¸ì…˜ ìƒì„±(initiator=false) â†’ kid ë°œê¸‰/ë°”ì¸ë”© â†’ Ack ì‘ë‹µ

1. TaskIdê°€ TaskHPKECompleteì¸ì§€ í™•ì¸, ë°ì´í„° íŒŒíŠ¸ íŒŒì‹±
2. ë©”íƒ€ ì„œëª… ê²€ì¦(ê²°ì •ë¡  ì§ë ¬í™” ë°”ì´íŠ¸, Ed25519) + DID ì¡°íšŒ
3. payload íŒŒì‹±: enc, info, exportCtx, nonce, ts, initDID, respDID
4. ì‹œê°„ ìŠ¤í(Â±maxSkew, ê¸°ë³¸ 2m) / ì¬ìƒ ë°©ì§€(nonce ìŠ¤í† ì–´)
5. info/exportCtx ì¬ê³„ì‚° í›„ ì •í•©ì„± ê²€ì‚¬
6. HPKE Base(ìˆ˜ì‹ ì) â†’ exporter ë³µì› (HPKEOpenSharedSecretWithPriv)
7. ì„¸ì…˜ ìƒì„±(initiator=false)
8. kid ë°œê¸‰(ì˜µì…˜: binder.IssueKeyID) & ë°”ì¸ë”©
9. ackTag = HMAC(exporter, ctxID|nonce|kid) ìƒì„± â†’ Ack ë©”íƒ€(kid, ackTagB64, ts) ë°˜í™˜

#### 5.2.3 ì„¸ì…˜ ê´€ë¦¬

**session/session.go** (664ì¤„)

```go
// ë³´ì•ˆ ì„¸ì…˜ êµ¬ì¡°ì²´
type SecureSession struct {
    id           string
    createdAt    time.Time
    lastUsedAt   time.Time
    messageCount int
    config       Config
    closed       bool

    // ì—­í•  (initiator = trueë©´ í´ë¼ì´ì–¸íŠ¸)
    initiator    bool

    // ì•”í˜¸í™” ì¬ë£Œ
    sessionSeed  []byte     // HKDF PRK
    encryptKey   []byte     // ë‹¨ì¼ ë°©í–¥ìš©
    signingKey   []byte

    // ë°©í–¥ë³„ í‚¤
    outKey       []byte     // ì†¡ì‹  ì•”í˜¸í™”
    inKey        []byte     // ìˆ˜ì‹  ì•”í˜¸í™”
    outSign      []byte     // ì†¡ì‹  ì„œëª…
    inSign       []byte     // ìˆ˜ì‹  ì„œëª…

    // AEAD ì¸ìŠ¤í„´ìŠ¤
    aead         cipher.AEAD    // ë ˆê±°ì‹œ
    aeadOut      cipher.AEAD    // ì†¡ì‹ ìš©
    aeadIn       cipher.AEAD    // ìˆ˜ì‹ ìš©
}

// í•µì‹¬ í•¨ìˆ˜:

1. NewSecureSessionFromExporterWithRole()
   - HPKE ìµìŠ¤í¬í„° ë¹„ë°€ì—ì„œ ì„¸ì…˜ ìƒì„±
   - initiatorì— ë”°ë¼ í‚¤ ë°©í–¥ ê²°ì •

2. DeriveSessionSeed()
   - HKDF-Extractë¡œ PRK ìƒì„±
   - Salt = SHA256(label + contextID + ephKeys)

3. ComputeSessionIDFromSeed()
   - ê²°ì •ë¡ ì  ì„¸ì…˜ ID ìƒì„±
   - Base64(SHA256(seed)[0:16])

4. deriveDirectionalKeys()
   - c2s (client-to-server) í‚¤ ìœ ë„
   - s2c (server-to-client) í‚¤ ìœ ë„
   - ê°ê° ì•”í˜¸í™” í‚¤ + ì„œëª… í‚¤

5. EncryptOutbound() / DecryptInbound()
   - ChaCha20-Poly1305 ì‚¬ìš©
   - Nonce (12ë°”ì´íŠ¸) + Ciphertext

6. Close()
   - ëª¨ë“  í‚¤ ë©”ëª¨ë¦¬ë¥¼ 0ìœ¼ë¡œ ë®ì–´ì“°ê¸°
   - ë³´ì•ˆ ì‚­ì œ

ìœ„ì¹˜: /session/session.go:1-664
```

**session/manager.go**

```go
// ì„¸ì…˜ ê´€ë¦¬ì
type Manager struct {
    sessions map[string]*SecureSession  // sessionID -> Session
    keyIDs   map[string]string         // keyID -> sessionID
    mu       sync.RWMutex
    config   Config
}

// í•µì‹¬ ê¸°ëŠ¥:

1. CreateSession()
   - ìƒˆ ì„¸ì…˜ ìƒì„± ë° ë“±ë¡
   - ê³ ìœ  ID í• ë‹¹

2. BindKeyID()
   - KeyIDë¥¼ ì„¸ì…˜ IDì— ë°”ì¸ë”©
   - RFC 9421 ì„œëª…ì— ì‚¬ìš©

3. GetByKeyID()
   - KeyIDë¡œ ì„¸ì…˜ ì¡°íšŒ
   - ì„œëª… ê²€ì¦ ì‹œ ì‚¬ìš©

4. CleanupExpired()
   - ì£¼ê¸°ì ìœ¼ë¡œ ë§Œë£Œ ì„¸ì…˜ ì œê±°
   - ë©”ëª¨ë¦¬ ê´€ë¦¬

ìœ„ì¹˜: /session/manager.go
```

### 5.3 ë°ì´í„° íë¦„ ìš”ì•½

```
ì™„ì „í•œ í†µì‹  í”Œë¡œìš°:

1. ì´ˆê¸°í™”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Agent A                              â”‚
   â”‚ - Ed25519 í‚¤ ë¡œë“œ                    â”‚
   â”‚ - DID ì„¤ì •                           â”‚
   â”‚ - gRPC ì—°ê²° ìˆ˜ë¦½                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. DID ì¡°íšŒ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ A â†’ Ethereum: getAgent(Bì˜ ì£¼ì†Œ)     â”‚
   â”‚ Ethereum â†’ A: Bì˜ ë©”íƒ€ë°ì´í„°          â”‚
   â”‚   - ê³µê°œí‚¤                            â”‚
   â”‚   - ì—”ë“œí¬ì¸íŠ¸                        â”‚
   â”‚   - ê¸°ëŠ¥                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. í•¸ë“œì…°ì´í¬ (2ë‹¨ê³„)
   [ìƒì„¸ëŠ” Part 4ì—ì„œ ë‹¤ë£¸]

4. ë³´ì•ˆ í†µì‹ 
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ A: ë©”ì‹œì§€ ì‘ì„±                        â”‚
   â”‚ â†“                                    â”‚
   â”‚ A: ì„¸ì…˜ í‚¤ë¡œ ì•”í˜¸í™”                   â”‚
   â”‚ â†“                                    â”‚
   â”‚ A: RFC 9421 ì„œëª… ìƒì„±                â”‚
   â”‚ â†“                                    â”‚
   â”‚ A â†’ B: ì•”í˜¸í™”ëœ ë©”ì‹œì§€ + ì„œëª…          â”‚
   â”‚ â†“                                    â”‚
   â”‚ B: ì„œëª… ê²€ì¦                          â”‚
   â”‚ â†“                                    â”‚
   â”‚ B: ë³µí˜¸í™”                             â”‚
   â”‚ â†“                                    â”‚
   â”‚ B: ë©”ì‹œì§€ ì²˜ë¦¬                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. ì„¸ì…˜ ì¢…ë£Œ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ì¡°ê±´ ì²´í¬:                            â”‚
   â”‚ - MaxAge ì´ˆê³¼?                       â”‚
   â”‚ - IdleTimeout ì´ˆê³¼?                  â”‚
   â”‚ - MaxMessages ì´ˆê³¼?                  â”‚
   â”‚ â†“                                    â”‚
   â”‚ YES: ì„¸ì…˜ ì •ë¦¬                        â”‚
   â”‚ - ëª¨ë“  í‚¤ ì‚­ì œ                        â”‚
   â”‚ - ë§¤ë‹ˆì €ì—ì„œ ì œê±°                     â”‚
   â”‚ - ë¦¬ì†ŒìŠ¤ í•´ì œ                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë‹¤ìŒ íŒŒíŠ¸ ì˜ˆê³ 

**Part 2: ì•”í˜¸í™” ì‹œìŠ¤í…œ Deep Dive**ì—ì„œëŠ” ë‹¤ìŒ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤:

1. Ed25519, Secp256k1, X25519ì˜ ìˆ˜í•™ì  ì›ë¦¬
2. HPKEì˜ ë‚´ë¶€ ë™ì‘ ì›ë¦¬
3. ChaCha20-Poly1305 AEAD ì•”í˜¸í™”
4. HKDF í‚¤ ìœ ë„ í•¨ìˆ˜ ìƒì„¸
5. í‚¤ ë³€í™˜ ê³¼ì • (Ed25519 â†” X25519)
6. ì‹¤ì œ ì½”ë“œ ì˜ˆì œì™€ í…ŒìŠ¤íŠ¸

**Part 3: DID ë° ë¸”ë¡ì²´ì¸ í†µí•©**ì—ì„œëŠ”:

1. Ethereum ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ìƒì„¸ ë¶„ì„
2. ì˜¨ì²´ì¸ ë°ì´í„° êµ¬ì¡°
3. ê°€ìŠ¤ ìµœì í™” ê¸°ë²•
4. ë‹¤ì¤‘ ì²´ì¸ ì§€ì› êµ¬í˜„
5. DID ì¡°íšŒ ë° ìºì‹± ì „ëµ

```

```
