# 사용자 시나리오 요약

## 단계 설명

1. AI Agent A, B는 각각 DID 컨트랙트를 통해 pubkey 및 메타정보 등록 (Tx 처리)
2. A는 B에게 메시지를 보낼 때, RFC 9421 기준으로 메시지 일부/전체를 서명함
3. B는 A의 메시지를 수신 후, A의 DID를 기반으로 블록체인에서 A의 pubkey를 조회함
4. RFC 9421 검증 방식으로 A의 서명이 유효한지 검증
   검증되면 B는 요청을 처리하고, 응답에 대해 B의 private key로 서명하여 A에게 보냄
   A는 B의 응답도 위와 동일한 방식으로 검증함

## 단계 설명 (Secure session)

1. **AI Agent A/B 등록**: 각 에이전트는 DID 컨트랙트에 자체 DID, 공개키, 메타정보를 등록함(온체인 Tx).
2. **상대 조회 + 핸드셰이크 시작**: A는 B와 임시 세션 공개키 교환을 위한 핸드셰이크를 수행하며, B의 DID를 기반으로 레지스트리에서 공개키를 조회해 요청 복호화/서명 검증을 수행함.
3. **세션 성립**: 핸드셰이크(임시 키 교환) 완료 시 A와 B는 동일한 공유 비밀()(shared secret)에서 같은 세션 ID/세션 키를 파생하고, 그 세션 범위에서 서로의 메시지를 암·복호화 및 서명 검증을 할 수 있음.
4. **A→B 전송**: A는 B에게 메시지를 보낼 때 세션 키로 암호화하고, RFC 9421 규약에 따라 메시지의 일부/전체를 서명함.
5. **B의 수신 검증**: B는 수신한 메시지를 세션 키로 복호화한 뒤, RFC 9421 검증으로 A의 서명 유효성을 확인함.
6. **B→A 응답**: 검증이 통과되면 B는 요청을 처리하고, 응답을 세션 키로 서명 및 암호화하여 A에게 전송함.
7. **A의 수신 검증**: A도 동일한 방식으로 B의 응답을 복호화/검증함.
